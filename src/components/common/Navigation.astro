---
// Navigation component
---

<nav id="main-nav" class="fixed top-0 left-0 right-0 bg-white bg-opacity-95 backdrop-blur-md border-b border-gray-200 z-50 transition-all duration-500 ease-in-out">
  <div class="nav-container">
    <a href="/" class="logo" aria-label="Kancelaria Radcy Prawnego Diana Magdalena Kalinowska - strona główna">
      <img src="/logo-small.webp" alt="Logo Kancelarii" width="116" height="96" class="logo-image" />
      <div class="logo-text">
        <span class="logo-line-1">Kancelaria Radcy Prawnego</span>
        <span class="logo-line-2">Diana Magdalena Kalinowska</span>
      </div>
    </a>
    <ul class="nav-links">
      <li><a href="/#uslugi">Usługi</a></li>
      <li><a href="/#o-mnie">O nas</a></li>
      <li><a href="/blog">Artykuły</a></li>
      <li><a href="/#kontakt">Kontakt</a></li>
    </ul>
    <a href="tel:+48503606738" class="phone-number">
      <span class="material-icons text-lg" aria-hidden="true">phone</span>
      +48 503 606 738
    </a>
    <button id="mobile-menu-toggle" class="mobile-menu-toggle" aria-label="Toggle menu" aria-expanded="false">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
  </div>
</nav>

<!-- Mobile Menu Backdrop -->
<div id="mobile-menu-backdrop" class="mobile-menu-backdrop"></div>

<!-- Mobile Menu Panel -->
<div id="mobile-menu" class="mobile-menu">
  <div class="mobile-menu-header">
    <button id="mobile-menu-close" class="mobile-menu-close" aria-label="Close menu">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>
  <div class="mobile-menu-content">
    <ul class="mobile-nav-links">
      <li><a href="/#uslugi">Usługi</a></li>
      <li><a href="/#o-mnie">O nas</a></li>
      <li><a href="/blog">Artykuły</a></li>
      <li><a href="/#kontakt">Kontakt</a></li>
    </ul>
    <a href="tel:+48503606738" class="mobile-phone-number">
      <span class="material-icons" aria-hidden="true">phone</span>
      +48 503 606 738
    </a>
    <a href="/" class="mobile-menu-logo" aria-label="Kancelaria Radcy Prawnego Diana Magdalena Kalinowska - strona główna">
      <img src="/logo-small.webp" alt="Logo Kancelarii" width="116" height="96" class="mobile-menu-logo-image" />
      <div class="mobile-menu-logo-text">
        <span class="mobile-menu-logo-line-1">Kancelaria Radcy Prawnego</span>
        <span class="mobile-menu-logo-line-2">Diana Magdalena Kalinowska</span>
      </div>
    </a>
  </div>
</div>

<script is:inline>
  function setupMobileMenu() {
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenuClose = document.getElementById('mobile-menu-close');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
    const body = document.body;

    if (!mobileMenuToggle || !mobileMenu) return;

    // Remove old listeners by cloning elements (prevents duplicate listeners)
    const newToggle = mobileMenuToggle.cloneNode(true);
    const newClose = mobileMenuClose?.cloneNode(true);
    const newBackdrop = mobileMenuBackdrop?.cloneNode(true);

    mobileMenuToggle.parentNode?.replaceChild(newToggle, mobileMenuToggle);
    if (mobileMenuClose && newClose) {
      mobileMenuClose.parentNode?.replaceChild(newClose, mobileMenuClose);
    }
    if (mobileMenuBackdrop && newBackdrop) {
      mobileMenuBackdrop.parentNode?.replaceChild(newBackdrop, mobileMenuBackdrop);
    }

    function toggleMobileMenu() {
      const menu = document.getElementById('mobile-menu');
      const toggle = document.getElementById('mobile-menu-toggle');
      const backdrop = document.getElementById('mobile-menu-backdrop');

      const isOpen = menu?.classList.toggle('open');
      toggle?.classList.toggle('open');
      backdrop?.classList.toggle('open');
      toggle?.setAttribute('aria-expanded', isOpen ? 'true' : 'false');

      if (isOpen) {
        document.body.style.overflow = 'hidden';
      } else {
        document.body.style.overflow = '';
      }
    }

    function closeMobileMenu() {
      const menu = document.getElementById('mobile-menu');
      const toggle = document.getElementById('mobile-menu-toggle');
      const backdrop = document.getElementById('mobile-menu-backdrop');

      menu?.classList.remove('open');
      toggle?.classList.remove('open');
      backdrop?.classList.remove('open');
      toggle?.setAttribute('aria-expanded', 'false');
      document.body.style.overflow = '';
    }

    // Add new listeners
    document.getElementById('mobile-menu-toggle')?.addEventListener('click', toggleMobileMenu);
    document.getElementById('mobile-menu-close')?.addEventListener('click', closeMobileMenu);
    document.getElementById('mobile-menu-backdrop')?.addEventListener('click', closeMobileMenu);

    // Close menu when clicking on a link
    document.querySelectorAll('.mobile-nav-links a').forEach(link => {
      link.addEventListener('click', closeMobileMenu);
    });
  }

  // Setup on initial load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupMobileMenu);
  } else {
    setupMobileMenu();
  }

  // Re-setup after Astro view transitions
  document.addEventListener('astro:page-load', setupMobileMenu);
</script>
