---
import Layout from '@/layouts/Layout.astro';
import Navigation from '@/components/common/Navigation.astro';
import Hero from '@/components/sections/Hero.astro';
import Services from '@/components/sections/Services.astro';
import About from '@/components/sections/About.astro';
import Contact from '@/components/sections/Contact.astro';
import Footer from '@/components/common/Footer.astro';
import { legalServiceSchema, generateStructuredData } from '@/utils/structuredData';

const title = "Kancelaria Radcy Prawnego Białystok - Diana Magdalena Kalinowska";
const description = "Radca prawny w Białymstoku. Prawo cywilne, karne, rodzinne, gospodarcze, prawo pracy i windykacja. Skontaktuj się: +48 503 606 738.";
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<Layout 
      title={title}
      description={description}
  canonicalURL={canonicalURL}
>
  <Navigation />
  <Hero />
    <main>
    <Services />
    <About />
    <Contact />
    </main>
  <Footer />

  <Fragment set:html={generateStructuredData(legalServiceSchema)} />

    <script>
      // Navigation scroll effect with throttling for smooth performance
      let ticking = false;
      
      function handleNavScroll() {
        if (!ticking) {
          requestAnimationFrame(() => {
            const nav = document.getElementById('main-nav');
            const scrollY = window.scrollY;
            
            if (scrollY > 100) {
              nav.classList.add('scrolled');
            } else {
              nav.classList.remove('scrolled');
            }
            
            ticking = false;
          });
          ticking = true;
        }
      }

      // Add scroll event listener with passive option for better performance
      window.addEventListener('scroll', handleNavScroll, { passive: true });

      // Intersection Observer for scroll animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px",
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("visible");
          }
        });
      }, observerOptions);

    // Initialize animations on page load
    function initializeAnimations() {
      const animatedElements = document.querySelectorAll(".animate-on-scroll");
        animatedElements.forEach((el, index) => {
          // Add staggered delay for service cards scroll animation only
          if (el.classList.contains("service-card")) {
            el.style.setProperty("--scroll-delay", `${index * 0.05}s`);
          }
          observer.observe(el);
        });
    }

    // Initialize on DOM content loaded
    document.addEventListener("DOMContentLoaded", initializeAnimations);

    // Re-initialize after view transitions
    document.addEventListener("astro:page-load", initializeAnimations);

    // Smooth scroll for anchor links
    document.addEventListener("astro:page-load", () => {
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
        });
      });
    </script>
</Layout>
